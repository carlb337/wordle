<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Wordle & Nags Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 15px;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        #horse-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }

        #money-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9997;
        }

        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .sound-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .sound-toggle:active {
            transform: scale(0.95);
        }

        .sound-toggle.muted {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .victory-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            color: white;
            padding: 40px 60px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 10001;
            opacity: 0;
            transition: all 0.5s ease;
            border: 5px solid #fff;
        }

        .victory-banner.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .victory-banner h2 {
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .victory-banner .winner-name {
            font-size: 72px;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            animation: glow 2s infinite;
        }

        .victory-banner .winner-score {
            font-size: 36px;
            margin-top: 10px;
            opacity: 0.95;
        }

        .victory-banner .close-btn {
            margin-top: 30px;
            padding: 15px 40px;
            background: white;
            color: #d97706;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .victory-banner .close-btn:hover {
            transform: scale(1.05);
        }

        .victory-banner .close-btn:active {
            transform: scale(0.95);
        }

        @keyframes glow {
            0%, 100% { text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 255, 255, 0.5); }
            50% { text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4), 0 0 40px rgba(255, 255, 255, 0.8); }
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 20px 15px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 15px;
        }

        h1 {
            color: #333;
            margin-bottom: 6px;
            text-align: center;
            font-size: 22px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 12px;
        }

        .friday-banner {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 13px;
            display: none;
            animation: pulse 2s infinite;
        }

        .friday-banner.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .day-selector {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #555;
            font-weight: 600;
            font-size: 13px;
        }

        select {
            width: 100%;
            padding: 12px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .reset-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
            width: 100%;
            touch-action: manipulation;
        }

        .reset-btn:active {
            background: #dc2626;
            transform: scale(0.98);
        }

        .finish-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border: none;
            padding: 18px 20px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            touch-action: manipulation;
            margin-top: 20px;
        }

        .finish-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.5);
        }

        .finish-btn:active {
            transform: scale(0.98);
        }

        .finish-section {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .finish-section.active {
            display: block;
        }

        .save-indicator {
            text-align: center;
            color: #10b981;
            font-size: 11px;
            margin-bottom: 12px;
            min-height: 16px;
            font-weight: 600;
        }

        .sync-status {
            text-align: center;
            color: #3b82f6;
            font-size: 10px;
            margin-bottom: 8px;
            min-height: 14px;
            font-weight: 600;
        }

        .wednesday-section {
            display: none;
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .wednesday-section.active {
            display: block;
        }

        .wednesday-title {
            font-size: 15px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
            text-align: center;
        }

        .wednesday-input-group {
            margin-bottom: 12px;
        }

        .wednesday-input-group:last-child {
            margin-bottom: 0;
        }

        .wednesday-input-group label {
            font-size: 12px;
            color: #92400e;
            margin-bottom: 5px;
        }

        .wednesday-input-group input[type="text"] {
            width: 100%;
            padding: 10px 8px;
            border: 2px solid #f59e0b;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .wednesday-input-group input[type="text"]:focus {
            outline: none;
            border-color: #d97706;
        }

        .wednesday-input-group input[type="time"] {
            padding: 10px 8px;
            border: 2px solid #f59e0b;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            background: white;
        }

        .wednesday-input-group input[type="time"]:focus {
            outline: none;
            border-color: #d97706;
        }

        .meeting-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 8px;
            align-items: start;
        }

        .person-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            transition: transform 0.2s;
        }

        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .person-name {
            font-size: 16px;
            font-weight: 700;
            color: #333;
        }

        .person-daily-total {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
        }

        .person-daily-total.friday-bonus {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 11px;
            margin-bottom: 5px;
            color: #666;
        }

        input[type="number"], input[type="text"] {
            padding: 10px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .decimal-display {
            font-size: 10px;
            color: #667eea;
            margin-top: 3px;
            min-height: 14px;
            font-weight: 600;
        }

        .totals-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .totals-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        .total-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .total-name {
            font-size: 15px;
        }

        .total-value {
            font-size: 18px;
        }

        .help-text {
            font-size: 10px;
            color: #999;
            text-align: center;
            margin-top: 8px;
            line-height: 1.4;
        }

        .racing-results-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .racing-results-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            text-decoration: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            touch-action: manipulation;
        }

        .racing-results-btn:active {
            transform: scale(0.98);
        }

        @media (min-width: 600px) {
            body {
                padding: 20px;
                align-items: center;
            }

            .container {
                padding: 40px;
            }

            h1 {
                font-size: 28px;
            }

            .subtitle {
                font-size: 14px;
            }

            .controls {
                flex-direction: row;
                gap: 10px;
            }

            .reset-btn {
                width: auto;
                align-self: flex-end;
            }

            .person-card {
                padding: 18px;
            }

            .input-row {
                gap: 12px;
            }

            input[type="number"], input[type="text"] {
                padding: 12px;
            }

            .meeting-row {
                grid-template-columns: 140px 1fr;
                gap: 12px;
            }

            .victory-banner h2 {
                font-size: 56px;
            }

            .victory-banner .winner-name {
                font-size: 96px;
            }
        }

        @media (max-width: 380px) {
            .container {
                padding: 15px 12px;
            }

            h1 {
                font-size: 20px;
            }

            .person-name {
                font-size: 15px;
            }

            .person-daily-total {
                font-size: 12px;
                padding: 4px 8px;
            }

            .input-row {
                gap: 6px;
            }

            input[type="number"], input[type="text"] {
                padding: 9px 6px;
                font-size: 14px;
            }

            .meeting-row {
                grid-template-columns: 100px 1fr;
                gap: 6px;
            }

            .sound-toggle {
                bottom: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            .victory-banner {
                padding: 30px 20px;
                width: 90%;
            }

            .victory-banner h2 {
                font-size: 32px;
            }

            .victory-banner .winner-name {
                font-size: 48px;
            }

            .victory-banner .winner-score {
                font-size: 24px;
            }

            .finish-btn {
                font-size: 18px;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    <canvas id="horse-canvas"></canvas>
    <canvas id="money-canvas"></canvas>

    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>

    <div class="victory-banner" id="victoryBanner">
        <h2>üèÜ WINNER! üèÜ</h2>
        <div class="winner-name" id="winnerName">Carl</div>
        <div class="winner-score" id="winnerScore">Score: 100.00</div>
        <button class="close-btn" onclick="closeVictoryBanner()">Close</button>
    </div>

    <div class="container">
        <h1>üìä Wordle & Nags Tracker</h1>
        <p class="subtitle">Track daily scores and view running totals</p>

        <div class="sync-status" id="syncStatus">üîÑ Connecting...</div>

        <div class="friday-banner" id="fridayBanner">
            üéâ FRIDAY BONUS! All points doubled! üéâ
        </div>

        <div class="controls">
            <div class="day-selector">
                <label for="daySelect">Select Day of Week</label>
                <select id="daySelect" onchange="loadDayData()">
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                </select>
            </div>
            <button class="reset-btn" onclick="resetData()">Reset All Data</button>
        </div>

        <div class="wednesday-section" id="wednesdaySection">
            <div class="wednesday-title">üìÖ Wednesday Details</div>
            
            <div class="wednesday-input-group">
                <label>Today's word is:</label>
                <input type="text" id="wednesday-word" oninput="saveWednesdayData()" placeholder="Enter the word...">
            </div>

            <div class="wednesday-input-group">
                <label>Today's meeting is:</label>
                <div class="meeting-row">
                    <input type="time" id="wednesday-meeting-time" onchange="saveWednesdayData()">
                    <input type="text" id="wednesday-meeting-details" oninput="saveWednesdayData()" placeholder="Meeting details...">
                </div>
            </div>
        </div>

        <div class="save-indicator" id="saveIndicator"></div>

        <div id="inputSection">
            <div class="person-card">
                <div class="person-header">
                    <div class="person-name">Carl</div>
                    <div class="person-daily-total" id="carl-daily">0.00</div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Wordle</label>
                        <input type="number" id="carl-wordle" step="1" min="0" inputmode="numeric" oninput="handleWordleInput('carl')">
                    </div>
                    <div class="input-group">
                        <label>Nags (e.g., 1 1/2 or 1.5)</label>
                        <input type="text" id="carl-nags" oninput="updateNagsDecimal('carl')">
                        <div class="decimal-display" id="carl-nags-decimal"></div>
                    </div>
                </div>
            </div>

            <div class="person-card">
                <div class="person-header">
                    <div class="person-name">Mat</div>
                    <div class="person-daily-total" id="mat-daily">0.00</div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Wordle</label>
                        <input type="number" id="mat-wordle" step="1" min="0" inputmode="numeric" oninput="handleWordleInput('mat')">
                    </div>
                    <div class="input-group">
                        <label>Nags (e.g., 1 1/2 or 1.5)</label>
                        <input type="text" id="mat-nags" oninput="updateNagsDecimal('mat')">
                        <div class="decimal-display" id="mat-nags-decimal"></div>
                    </div>
                </div>
            </div>

            <div class="person-card">
                <div class="person-header">
                    <div class="person-name">Phill</div>
                    <div class="person-daily-total" id="phill-daily">0.00</div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Wordle</label>
                        <input type="number" id="phill-wordle" step="1" min="0" inputmode="numeric" oninput="handleWordleInput('phill')">
                    </div>
                    <div class="input-group">
                        <label>Nags (e.g., 1 1/2 or 1.5)</label>
                        <input type="text" id="phill-nags" oninput="updateNagsDecimal('phill')">
                        <div class="decimal-display" id="phill-nags-decimal"></div>
                    </div>
                </div>
            </div>
        </div>

        <p class="help-text">üí° Enter nags as fractions (1 1/2), decimals (1.5), or whole numbers (2)<br>üéâ Friday scores are automatically doubled!<br>üê¥ Nags odds of 5.0+ trigger a celebration!</p>

        <div class="totals-section">
            <div class="totals-title">Overall Totals</div>
            <div class="total-card">
                <span class="total-name">Carl</span>
                <span class="total-value" id="carl-total">0.00</span>
            </div>
            <div class="total-card">
                <span class="total-name">Mat</span>
                <span class="total-value" id="mat-total">0.00</span>
            </div>
            <div class="total-card">
                <span class="total-name">Phill</span>
                <span class="total-value" id="phill-total">0.00</span>
            </div>
        </div>

        <div class="finish-section" id="finishSection">
            <button class="finish-btn" onclick="finishWeek()">
                üèÅ FINISH - Declare Winner! üèÅ
            </button>
        </div>

        <div class="racing-results-section">
            <a href="https://www.bbc.co.uk/sport/horse-racing/uk-ireland/results" target="_blank" class="racing-results-btn">
                üê¥ View Horse Racing Results
            </a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyAbOnhiomdlDyTFZfYMfteoIm8fwHKRKsk",
  authDomain: "wordle-1affc.firebaseapp.com",
  databaseURL: "https://wordle-1affc-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wordle-1affc",
  storageBucket: "wordle-1affc.firebasestorage.app",
  messagingSenderId: "242269500720",
  appId: "1:242269500720:web:af2adc376cd9b1b60c44f5"
};

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dataRef = database.ref('wordleNagsData');

        // Sound Management
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();

        function playCelebrationSound() {
            if (!soundEnabled) return;
            audioContext.resume();
            
            const now = audioContext.currentTime;
            
            [0, 0.08, 0.16, 0.24].forEach((delay, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                const notes = [523.25, 659.25, 783.99, 1046.50];
                osc.frequency.setValueAtTime(notes[i], now + delay);
                osc.type = 'sine';
                
                gain.gain.setValueAtTime(0, now + delay);
                gain.gain.linearRampToValueAtTime(0.3, now + delay + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.3);
                
                osc.start(now + delay);
                osc.stop(now + delay + 0.3);
            });
        }

        function playHorseSound() {
            if (!soundEnabled) return;
            audioContext.resume();
            
            const now = audioContext.currentTime;
            
            [0, 0.12, 0.24, 0.36].forEach((delay) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.type = 'square';
                osc.frequency.setValueAtTime(80, now + delay);
                osc.frequency.exponentialRampToValueAtTime(40, now + delay + 0.05);
                
                gain.gain.setValueAtTime(0.3, now + delay);
                gain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.05);
                
                osc.start(now + delay);
                osc.stop(now + delay + 0.05);
            });
            
            setTimeout(() => {
                const trumpet = audioContext.createOscillator();
                const trumpetGain = audioContext.createGain();
                const now = audioContext.currentTime;
                
                trumpet.connect(trumpetGain);
                trumpetGain.connect(audioContext.destination);
                
                trumpet.type = 'sawtooth';
                
                const melody = [
                    { freq: 392, time: 0, duration: 0.15 },
                    { freq: 523.25, time: 0.15, duration: 0.15 },
                    { freq: 659.25, time: 0.3, duration: 0.25 },
                    { freq: 783.99, time: 0.55, duration: 0.4 }
                ];
                
                melody.forEach(note => {
                    trumpet.frequency.setValueAtTime(note.freq, now + note.time);
                });
                
                trumpetGain.gain.setValueAtTime(0, now);
                trumpetGain.gain.linearRampToValueAtTime(0.25, now + 0.01);
                trumpetGain.gain.setValueAtTime(0.25, now + 0.8);
                trumpetGain.gain.exponentialRampToValueAtTime(0.01, now + 1);
                
                trumpet.start(now);
                trumpet.stop(now + 1);
            }, 500);
        }

        // Victory fanfare sound - epic trumpet melody
        function playVictorySound() {
            if (!soundEnabled) return;
            audioContext.resume();
            
            const now = audioContext.currentTime;
            
            // Epic fanfare progression
            const fanfare = [
                { freq: 523.25, time: 0, duration: 0.2 },     // C5
                { freq: 659.25, time: 0.2, duration: 0.2 },   // E5
                { freq: 783.99, time: 0.4, duration: 0.3 },   // G5
                { freq: 1046.50, time: 0.7, duration: 0.5 },  // C6
                { freq: 783.99, time: 1.2, duration: 0.2 },   // G5
                { freq: 1046.50, time: 1.4, duration: 0.6 }   // C6 (hold)
            ];
            
            fanfare.forEach(note => {
                // Main trumpet
                const osc1 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                
                osc1.connect(gain1);
                gain1.connect(audioContext.destination);
                
                osc1.type = 'sawtooth';
                osc1.frequency.setValueAtTime(note.freq, now + note.time);
                
                gain1.gain.setValueAtTime(0, now + note.time);
                gain1.gain.linearRampToValueAtTime(0.3, now + note.time + 0.02);
                gain1.gain.setValueAtTime(0.3, now + note.time + note.duration - 0.1);
                gain1.gain.exponentialRampToValueAtTime(0.01, now + note.time + note.duration);
                
                osc1.start(now + note.time);
                osc1.stop(now + note.time + note.duration);
                
                // Harmony (third above)
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(note.freq * 1.25, now + note.time);
                
                gain2.gain.setValueAtTime(0, now + note.time);
                gain2.gain.linearRampToValueAtTime(0.15, now + note.time + 0.02);
                gain2.gain.exponentialRampToValueAtTime(0.01, now + note.time + note.duration);
                
                osc2.start(now + note.time);
                osc2.stop(now + note.time + note.duration);
            });
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled);
            
            const button = document.getElementById('soundToggle');
            if (soundEnabled) {
                button.textContent = 'üîä';
                button.classList.remove('muted');
                
                audioContext.resume();
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.frequency.value = 800;
                gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 0.2);
            } else {
                button.textContent = 'üîá';
                button.classList.add('muted');
            }
        }

        window.addEventListener('load', () => {
            const button = document.getElementById('soundToggle');
            if (!soundEnabled) {
                button.textContent = 'üîá';
                button.classList.add('muted');
            }
        });

        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const horseCanvas = document.getElementById('horse-canvas');
        const horseCtx = horseCanvas.getContext('2d');
        horseCanvas.width = window.innerWidth;
        horseCanvas.height = window.innerHeight;

        const moneyCanvas = document.getElementById('money-canvas');
        const moneyCtx = moneyCanvas.getContext('2d');
        moneyCanvas.width = window.innerWidth;
        moneyCanvas.height = window.innerHeight;

        let confettiPieces = [];
        let horseEmojis = [];
        let moneyEmojis = [];
        let animationFrame;
        let horseAnimationFrame;
        let moneyAnimationFrame;
        let lastNagsValues = { carl: 0, mat: 0, phill: 0 };

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            horseCanvas.width = window.innerWidth;
            horseCanvas.height = window.innerHeight;
            moneyCanvas.width = window.innerWidth;
            moneyCanvas.height = window.innerHeight;
        });

        class ConfettiPiece {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height - canvas.height;
                this.w = Math.random() * 10 + 5;
                this.h = Math.random() * 5 + 5;
                this.vx = Math.random() * 2 - 1;
                this.vy = Math.random() * 3 + 2;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = Math.random() * 5 - 2.5;
                this.color = ['#667eea', '#764ba2', '#f59e0b', '#dc2626', '#10b981', '#3b82f6', '#ec4899'][Math.floor(Math.random() * 7)];
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;

                if (this.y > canvas.height) {
                    return false;
                }
                return true;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
                ctx.restore();
            }
        }

        class HorseEmoji {
            constructor() {
                this.x = Math.random() * horseCanvas.width;
                this.y = Math.random() * horseCanvas.height - horseCanvas.height;
                this.vx = Math.random() * 3 - 1.5;
                this.vy = Math.random() * 4 + 2;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = Math.random() * 8 - 4;
                this.size = Math.random() * 30 + 30;
                this.emoji = ['üê¥', 'üêé', 'üèá', 'üèÜ', 'ü•á', 'üåü', 'üí∞', 'üéØ'][Math.floor(Math.random() * 8)];
                this.opacity = 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                
                if (this.y > horseCanvas.height * 0.8) {
                    this.opacity -= 0.02;
                }
                
                if (this.y > horseCanvas.height || this.opacity <= 0) {
                    return false;
                }
                return true;
            }

            draw() {
                horseCtx.save();
                horseCtx.translate(this.x, this.y);
                horseCtx.rotate(this.rotation * Math.PI / 180);
                horseCtx.globalAlpha = this.opacity;
                horseCtx.font = `${this.size}px Arial`;
                horseCtx.textAlign = 'center';
                horseCtx.textBaseline = 'middle';
                horseCtx.fillText(this.emoji, 0, 0);
                horseCtx.restore();
            }
        }

        // Money Bag Emoji Class for Victory
        class MoneyEmoji {
            constructor() {
                this.x = Math.random() * moneyCanvas.width;
                this.y = Math.random() * moneyCanvas.height - moneyCanvas.height;
                this.vx = Math.random() * 4 - 2;
                this.vy = Math.random() * 5 + 2;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = Math.random() * 10 - 5;
                this.size = Math.random() * 40 + 40;
                this.emoji = ['üí∞', 'üíµ', 'üí¥', 'üí∂', 'üí∑', 'ü§ë', 'üíé', 'üèÜ', 'üëë'][Math.floor(Math.random() * 9)];
                this.opacity = 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                
                if (this.y > moneyCanvas.height * 0.7) {
                    this.opacity -= 0.015;
                }
                
                if (this.y > moneyCanvas.height || this.opacity <= 0) {
                    return false;
                }
                return true;
            }

            draw() {
                moneyCtx.save();
                moneyCtx.translate(this.x, this.y);
                moneyCtx.rotate(this.rotation * Math.PI / 180);
                moneyCtx.globalAlpha = this.opacity;
                moneyCtx.font = `${this.size}px Arial`;
                moneyCtx.textAlign = 'center';
                moneyCtx.textBaseline = 'middle';
                moneyCtx.fillText(this.emoji, 0, 0);
                moneyCtx.restore();
            }
        }

        function launchConfetti() {
            playCelebrationSound();
            
            for (let i = 0; i < 150; i++) {
                confettiPieces.push(new ConfettiPiece());
            }

            if (!animationFrame) {
                animateConfetti();
            }
        }

        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            confettiPieces = confettiPieces.filter(piece => {
                piece.draw();
                return piece.update();
            });

            if (confettiPieces.length > 0) {
                animationFrame = requestAnimationFrame(animateConfetti);
            } else {
                animationFrame = null;
            }
        }

        function launchHorseCelebration() {
            playHorseSound();
            
            for (let i = 0; i < 80; i++) {
                horseEmojis.push(new HorseEmoji());
            }
            
            if (!horseAnimationFrame) {
                animateHorses();
            }
        }

        function animateHorses() {
            horseCtx.clearRect(0, 0, horseCanvas.width, horseCanvas.height);
            
            horseEmojis = horseEmojis.filter(emoji => {
                emoji.draw();
                return emoji.update();
            });

            if (horseEmojis.length > 0) {
                horseAnimationFrame = requestAnimationFrame(animateHorses);
            } else {
                horseAnimationFrame = null;
            }
        }

        // Launch money celebration for victory
        function launchMoneyCelebration() {
            for (let i = 0; i < 100; i++) {
                moneyEmojis.push(new MoneyEmoji());
            }
            
            if (!moneyAnimationFrame) {
                animateMoney();
            }
        }

        function animateMoney() {
            moneyCtx.clearRect(0, 0, moneyCanvas.width, moneyCanvas.height);
            
            moneyEmojis = moneyEmojis.filter(emoji => {
                emoji.draw();
                return emoji.update();
            });

            if (moneyEmojis.length > 0) {
                moneyAnimationFrame = requestAnimationFrame(animateMoney);
            } else {
                moneyAnimationFrame = null;
            }
        }

        // Finish Week and Declare Winner
        function finishWeek() {
            // Calculate totals
            let carlTotal = 0, matTotal = 0, phillTotal = 0;

            ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].forEach(d => {
                carlTotal += calculateDailyTotal(data[d].carl.wordle, data[d].carl.nags, d);
                matTotal += calculateDailyTotal(data[d].mat.wordle, data[d].mat.nags, d);
                phillTotal += calculateDailyTotal(data[d].phill.wordle, data[d].phill.nags, d);
            });

            // Determine winner
            const scores = [
                { name: 'Carl', score: carlTotal },
                { name: 'Mat', score: matTotal },
                { name: 'Phill', score: phillTotal }
            ];

            scores.sort((a, b) => b.score - a.score);
            const winner = scores[0];

            // Check for tie
            const isTie = scores[0].score === scores[1].score;

            // Display victory banner
            const banner = document.getElementById('victoryBanner');
            const winnerName = document.getElementById('winnerName');
            const winnerScore = document.getElementById('winnerScore');

            if (isTie) {
                winnerName.textContent = 'TIE!';
                winnerScore.textContent = `${winner.score.toFixed(2)} points each!`;
            } else {
                winnerName.textContent = winner.name;
                winnerScore.textContent = `Score: ${winner.score.toFixed(2)} points`;
            }

            banner.classList.add('show');

            // Launch celebrations
            playVictorySound();
            launchConfetti();
            launchMoneyCelebration();
        }

        function closeVictoryBanner() {
            const banner = document.getElementById('victoryBanner');
            banner.classList.remove('show');
        }

        // Update Finish button visibility
        function updateFinishButton() {
            const day = document.getElementById('daySelect').value;
            const finishSection = document.getElementById('finishSection');
            
            if (day === 'Friday') {
                finishSection.classList.add('active');
            } else {
                finishSection.classList.remove('active');
            }
        }

        const defaultData = {
            Monday: { carl: { wordle: '', nags: '' }, mat: { wordle: '', nags: '' }, phill: { wordle: '', nags: '' } },
            Tuesday: { carl: { wordle: '', nags: '' }, mat: { wordle: '', nags: '' }, phill: { wordle: '', nags: '' } },
            Wednesday: { 
                carl: { wordle: '', nags: '' }, 
                mat: { wordle: '', nags: '' }, 
                phill: { wordle: '', nags: '' },
                word: '',
                meetingTime: '',
                meetingDetails: ''
            },
            Thursday: { carl: { wordle: '', nags: '' }, mat: { wordle: '', nags: '' }, phill: { wordle: '', nags: '' } },
            Friday: { carl: { wordle: '', nags: '' }, mat: { wordle: '', nags: '' }, phill: { wordle: '', nags: '' } }
        };

        let data = JSON.parse(JSON.stringify(defaultData));
        let isUpdatingFromFirebase = false;

        dataRef.on('value', (snapshot) => {
            const firebaseData = snapshot.val();
            if (firebaseData) {
                isUpdatingFromFirebase = true;
                data = firebaseData;
                loadDayData();
                isUpdatingFromFirebase = false;
                updateSyncStatus('‚úì Synced');
            } else {
                dataRef.set(defaultData);
            }
        });

        function updateSyncStatus(message) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            if (message.includes('‚úì')) {
                status.style.color = '#10b981';
                setTimeout(() => {
                    status.textContent = '';
                }, 2000);
            }
        }

        function saveToFirebase() {
            if (!isUpdatingFromFirebase) {
                dataRef.set(data).then(() => {
                    updateSyncStatus('‚úì Synced to cloud');
                }).catch((error) => {
                    updateSyncStatus('‚ö†Ô∏è Sync error');
                    console.error('Firebase save error:', error);
                });
            }
        }

        function saveWednesdayData() {
            if (!data.Wednesday.word) data.Wednesday.word = '';
            if (!data.Wednesday.meetingTime) data.Wednesday.meetingTime = '';
            if (!data.Wednesday.meetingDetails) data.Wednesday.meetingDetails = '';
            
            data.Wednesday.word = document.getElementById('wednesday-word').value || '';
            data.Wednesday.meetingTime = document.getElementById('wednesday-meeting-time').value || '';
            data.Wednesday.meetingDetails = document.getElementById('wednesday-meeting-details').value || '';
            
            saveToFirebase();
        }

        function updateWednesdaySection() {
            const day = document.getElementById('daySelect').value;
            const wednesdaySection = document.getElementById('wednesdaySection');
            
            if (day === 'Wednesday') {
                wednesdaySection.classList.add('active');
                if (data.Wednesday.word !== undefined) {
                    document.getElementById('wednesday-word').value = data.Wednesday.word || '';
                }
                if (data.Wednesday.meetingTime !== undefined) {
                    document.getElementById('wednesday-meeting-time').value = data.Wednesday.meetingTime || '';
                }
                if (data.Wednesday.meetingDetails !== undefined) {
                    document.getElementById('wednesday-meeting-details').value = data.Wednesday.meetingDetails || '';
                }
            } else {
                wednesdaySection.classList.remove('active');
            }
        }

        function fractionToDecimal(input) {
            if (!input || input === '' || input === '0') return 0;

            input = input.toString().trim();

            if (!isNaN(input)) {
                return parseFloat(input);
            }

            const wholeAndFraction = input.match(/^(\d+)\s+(\d+)\/(\d+)$/);
            if (wholeAndFraction) {
                const whole = parseInt(wholeAndFraction[1]);
                const numerator = parseInt(wholeAndFraction[2]);
                const denominator = parseInt(wholeAndFraction[3]);
                return whole + (numerator / denominator);
            }

            const justFraction = input.match(/^(\d+)\/(\d+)$/);
            if (justFraction) {
                const numerator = parseInt(justFraction[1]);
                const denominator = parseInt(justFraction[2]);
                return numerator / denominator;
            }

            return 0;
        }

        function handleWordleInput(person) {
            const value = document.getElementById(`${person}-wordle`).value;

            if (value === '1') {
                launchConfetti();
            }

            calculateTotals();
        }

        function checkFridayCompletion() {
            const day = document.getElementById('daySelect').value;

            if (day === 'Friday') {
                const carlWordle = data.Friday.carl.wordle;
                const matWordle = data.Friday.mat.wordle;
                const phillWordle = data.Friday.phill.wordle;

                if (carlWordle !== '' && matWordle !== '' && phillWordle !== '') {
                    launchConfetti();
                }
            }
        }

        function updateNagsDecimal(person) {
            const input = document.getElementById(`${person}-nags`).value;
            const decimal = fractionToDecimal(input);
            const displayElement = document.getElementById(`${person}-nags-decimal`);

            if (input && input !== '' && input !== '0') {
                displayElement.textContent = `= ${decimal.toFixed(2)}`;
            } else {
                displayElement.textContent = '';
            }

            if (decimal >= 5.0 && decimal > lastNagsValues[person]) {
                launchHorseCelebration();
            }

            lastNagsValues[person] = decimal;

            calculateTotals();
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.textContent = '‚úì Saved';
            setTimeout(() => {
                indicator.textContent = '';
            }, 2000);
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data to zero? This will affect all users!')) {
                data = JSON.parse(JSON.stringify(defaultData));
                lastNagsValues = { carl: 0, mat: 0, phill: 0 };
                saveToFirebase();
                loadDayData();
                alert('All data has been reset to zero!');
            }
        }

        function calculateDailyTotal(wordle, nags, day) {
            if ((!wordle || wordle === '' || wordle === 0) && (!nags || nags === '' || nags === '0')) {
                return 0;
            }

            const wordleNum = parseFloat(wordle || 0);
            const nagsDecimal = fractionToDecimal(nags);

            let wordleScore = 0;
            if (wordleNum > 0) {
                wordleScore = (wordleNum === 1) ? 10 : (7 - wordleNum);
            }

            const nagsScore = (nagsDecimal === 0) ? 0 : (nagsDecimal + 1);

            let total = wordleScore + nagsScore;

            if (day === 'Friday') {
                total = total * 2;
            }

            return total;
        }

        function updateFridayBanner() {
            const day = document.getElementById('daySelect').value;
            const banner = document.getElementById('fridayBanner');
            const dailyTotals = document.querySelectorAll('.person-daily-total');

            if (day === 'Friday') {
                banner.classList.add('active');
                dailyTotals.forEach(total => total.classList.add('friday-bonus'));
            } else {
                banner.classList.remove('active');
                dailyTotals.forEach(total => total.classList.remove('friday-bonus'));
            }
        }

        function loadDayData() {
            const day = document.getElementById('daySelect').value;
            const dayData = data[day];

            updateFridayBanner();
            updateWednesdaySection();
            updateFinishButton();

            document.getElementById('carl-wordle').value = dayData.carl.wordle || '';
            document.getElementById('carl-nags').value = dayData.carl.nags || '';
            lastNagsValues.carl = fractionToDecimal(dayData.carl.nags);
            updateNagsDecimal('carl');

            document.getElementById('mat-wordle').value = dayData.mat.wordle || '';
            document.getElementById('mat-nags').value = dayData.mat.nags || '';
            lastNagsValues.mat = fractionToDecimal(dayData.mat.nags);
            updateNagsDecimal('mat');

            document.getElementById('phill-wordle').value = dayData.phill.wordle || '';
            document.getElementById('phill-nags').value = dayData.phill.nags || '';
            lastNagsValues.phill = fractionToDecimal(dayData.phill.nags);
            updateNagsDecimal('phill');

            calculateTotals();
        }

        function saveDayData() {
            const day = document.getElementById('daySelect').value;

            if (day === 'Wednesday') {
                data[day] = {
                    carl: {
                        wordle: document.getElementById('carl-wordle').value || '',
                        nags: document.getElementById('carl-nags').value || ''
                    },
                    mat: {
                        wordle: document.getElementById('mat-wordle').value || '',
                        nags: document.getElementById('mat-nags').value || ''
                    },
                    phill: {
                        wordle: document.getElementById('phill-wordle').value || '',
                        nags: document.getElementById('phill-nags').value || ''
                    },
                    word: data.Wednesday.word || '',
                    meetingTime: data.Wednesday.meetingTime || '',
                    meetingDetails: data.Wednesday.meetingDetails || ''
                };
            } else {
                data[day] = {
                    carl: {
                        wordle: document.getElementById('carl-wordle').value || '',
                        nags: document.getElementById('carl-nags').value || ''
                    },
                    mat: {
                        wordle: document.getElementById('mat-wordle').value || '',
                        nags: document.getElementById('mat-nags').value || ''
                    },
                    phill: {
                        wordle: document.getElementById('phill-wordle').value || '',
                        nags: document.getElementById('phill-nags').value || ''
                    }
                };
            }

            saveToFirebase();
            checkFridayCompletion();
        }

        function calculateTotals() {
            saveDayData();

            const day = document.getElementById('daySelect').value;

            const carlDaily = calculateDailyTotal(data[day].carl.wordle, data[day].carl.nags, day);
            const matDaily = calculateDailyTotal(data[day].mat.wordle, data[day].mat.nags, day);
            const phillDaily = calculateDailyTotal(data[day].phill.wordle, data[day].phill.nags, day);

            document.getElementById('carl-daily').textContent = carlDaily.toFixed(2);
            document.getElementById('mat-daily').textContent = matDaily.toFixed(2);
            document.getElementById('phill-daily').textContent = phillDaily.toFixed(2);

            let carlTotal = 0, matTotal = 0, phillTotal = 0;

            ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].forEach(d => {
                carlTotal += calculateDailyTotal(data[d].carl.wordle, data[d].carl.nags, d);
                matTotal += calculateDailyTotal(data[d].mat.wordle, data[d].mat.nags, d);
                phillTotal += calculateDailyTotal(data[d].phill.wordle, data[d].phill.nags, d);
            });

            document.getElementById('carl-total').textContent = carlTotal.toFixed(2);
            document.getElementById('mat-total').textContent = matTotal.toFixed(2);
            document.getElementById('phill-total').textContent = phillTotal.toFixed(2);
        }

        window.onload = function() {
            updateSyncStatus('üîÑ Loading...');
        };
    </script>
</body>
</html>
